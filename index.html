<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>טופס פתיחת לקוח - Safe Book</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 0;
            box-sizing: border-box;
            background-color: #f4f4f4;
        }
        
        header {
            background-color: #ff7f50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 72px;
            font-weight: bold;
        }
        
        .contact-info {
            text-align: left;
            font-size: 14px;
            line-height: 1.2;
        }
        
        .contact-info p {
            margin: 0;
        }
        
        h1 {
            text-align: center;
            font-size: 24px;
            /* margin: 20px 0 10px; */
            color: #333;
        }
        
        .intro {
            text-align: center;
            margin-bottom: 20px;
            color: #555;
        }
        
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
        }
        
        th {
            background-color: #f9f9f9;
            font-weight: normal;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="email"] {
            width: 100%;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        .payment-terms,
        .digital-invoice {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .form-row {
            margin-bottom: 15px;
        }
        
        .form-row label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .signature-canvas {
            border: 1px solid #ddd;
            width: 100%;
            height: 150px;
            background-color: #fff;
        }
        
        .clear-signature-button {
            padding: 10px 20px;
            border: none;
            background-color: #ff7f50;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            outline: none;
        }
        
        .clear-signature-button:hover {
            background-color: #ff6f40;
        }
        
        .clear-signature-button:active {
            transform: scale(0.98);
        }
        
        .button-container {
            margin-top: 20px;
            text-align: center;
        }
        
        .button-container button {
            padding: 10px 20px;
            border: none;
            background-color: #ff7f50;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .button-container button:hover {
            background-color: #ff6f40;
        }
        
        .footer {
            background-color: #f4f4f4;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            color: #777;
        }
        
        .formStatus {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px;
            border-radius: 5px;
            font-size: 18px;
            width: calc(100% - 40px);
            box-sizing: border-box;
            display: none;
        }
        
        .error {
            color: #d8000c;
            background-color: #ffbaba;
            border: 1px solid #d8000c;
            text-align: center;
        }
        
        .success {
            color: #4f8a10;
            background-color: #dff2bf;
            border: 1px solid #4f8a10;
            text-align: center;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            text-align: center;
        }
        
        .loading-spinner {
            border: 8px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 8px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">S</div>
        <div class="contact-info">
            <p>סייף בוק בע"מ</p>
            <p>ח.פ. - 515911246</p>
            <p>המרכבה 18, חולון</p>
            <p style="color: white;"><a href="mailto:safebookline@gmail.com" style="color: white; text-decoration: none;">safebookline@gmail.com</a></p>
        </div>
    </header>
    <div class="container">
        <h1>טופס פתיחת לקוח</h1>
        <p class="intro">לקוח יקר, אנו שמחים שהצטרפת למשפחת הלקוחות שלנו!</p>
        <div id="formStatus" class="formStatus"></div>
        <form id="customerForm">
            <p>להלן הפרטים הדרושים לפתיחת כרטיס לקוח:</p>

            <table>
                <tr>
                    <th>תאריך:</th>
                    <th>שם עסק מלא:</th>
                    <th>ח.פ. / ע.מ:</th>
                </tr>
                <tr>
                    <td><input type="text" name="date" id="dateField" /></td>
                    <td><input type="text" name="businessName" /></td>
                    <td><input type="text" name="idNumber" /></td>
                </tr>
                <tr>
                    <th>כתובת בית העסק:</th>
                    <th>טלפון בית העסק:</th>
                    <th>פקס בית העסק:</th>
                </tr>
                <tr>
                    <td><input type="text" name="businessAddress" /></td>
                    <td><input type="number" name="businessPhone" /></td>
                    <td><input type="text" name="businessFax" /></td>
                </tr>
                <tr>
                    <th>כתובת מייל לקבלת חשבוניות:</th>
                    <th>שם איש קשר:</th>
                    <th>טלפון איש קשר:</th>
                </tr>
                <tr>
                    <td><input type="email" id="invoiceEmail" name="invoiceEmail" /></td>
                    <td><input type="text" name="contactName" /></td>
                    <td><input type="number" name="contactPhone" /></td>
                </tr>
            </table>

            <div class="payment-terms">
                <p>תנאי תשלום מוסכמים:</p>
                <div class="form-row">
                    <label for="paymentTerms">תנאים:</label>
                    <input type="text" id="paymentTerms" name="paymentTerms" />
                </div>
            </div>

            <div class="digital-invoice">
                <h3>אישור קבלת חשבוניות דיגיטליות במייל:</h3>
                <p>אנו מאשרים בזאת לחברת סייף בוק בע"מ על קבלת חשבוניות דיגיטליות במייל על החתום:</p>
                <div class="form-row">
                    <label for="companyName">שם חברה:</label>
                    <input type="text" id="companyName" name="companyName" />
                </div>
                <div class="form-row">
                    <label for="approverName">שם מאשר:</label>
                    <input type="text" id="approverName" name="approverName" />
                </div>
                <div class="form-row">
                    <label for="approverPosition">תפקיד מאשר:</label>
                    <input type="text" id="approverPosition" name="approverPosition" />
                </div>
            </div>

            <div class="signature">
                <label for="signatureCanvas">חתימה:</label>
                <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                <button type="button" onclick="clearSignature()" class="clear-signature-button">
                  נקה חתימה
              </button>
            </div>

            <div class="button-container">
                <button type="submit">שלח</button>
            </div>
        </form>
    </div>

    <footer class="footer">
        <p>&copy; 2024 <a href="#" style="color: #ff7f50; text-decoration: none;" target="_blank">Safe Book</a>. כל הזכויות שמורות.</p>
    </footer>

    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>אנא המתן...</p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            function setCurrentDate() {
                const dateField = document.getElementById('dateField');
                const today = new Date();
                const formattedDate = today.toISOString().split('T')[0]; // YYYY-MM-DD
                dateField.value = formattedDate;
            }

            setCurrentDate();

            document.getElementById("customerForm").addEventListener("submit", function(event) {
                event.preventDefault();

                const loadingScreen = document.getElementById("loadingScreen");
                loadingScreen.style.display = 'flex';

                const emailError = document.getElementById("invoiceEmailError");
                if (emailError) {
                    emailError.textContent = '';
                }

                const emailField = document.getElementById("invoiceEmail");
                const emailValue = emailField.value;

                if (!emailValue || !validateEmail(emailValue)) {
                    emailField.classList.add('highlight-error');
                    if (!emailError) {
                        const newEmailError = document.createElement('div');
                        newEmailError.id = "invoiceEmailError";
                        newEmailError.classList.add('error');
                        emailField.parentNode.insertBefore(newEmailError, emailField.nextSibling);
                    }
                    emailError.textContent = "נא להכניס כתובת אימייל חוקית.";
                    emailField.focus();

                    loadingScreen.style.display = 'none';
                    return;
                }

                emailField.classList.remove('highlight-error');
                if (emailError) {
                    emailError.textContent = '';
                }

                const formData = new FormData(this);
                const formObject = {};
                formData.forEach((value, key) => (formObject[key] = value));

                formObject.signature = canvas.toDataURL(); // Convert canvas to data URL

                fetch("https://script.google.com/macros/s/AKfycbyYX2oPMNThZ0beI_5fuIkUg8tH0Kze9c_MF6cQOuIGKSkh3EsMScZsrrbb9i4quykn/exec", {
                        method: "POST",
                        mode: "no-cors",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(formObject),
                    })
                    .then(response => response.text())
                    .then(result => {
                        const formStatus = document.getElementById("formStatus");
                        formStatus.textContent = "הטופס נשלח בהצלחה";
                        formStatus.classList.remove('error');
                        formStatus.classList.add('success');
                        formStatus.style.display = 'block';

                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });

                        document.getElementById("customerForm").reset();
                        clearSignature();
                    })
                    .catch(error => {
                        const formStatus = document.getElementById("formStatus");
                        formStatus.textContent = "שגיאה בשליחת הטופס: " + error.message;
                        formStatus.classList.remove('success');
                        formStatus.classList.add('error');
                        formStatus.style.display = 'block';
                        console.error("Error:", error);
                    })
                    .finally(() => {
                        loadingScreen.style.display = 'none';
                    });
            });

            function validateEmail(email) {
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailPattern.test(email);
            }

            const canvas = document.getElementById("signatureCanvas");
            const context = canvas.getContext("2d");
            let drawing = false;

            function resizeCanvas() {
                const ratio = window.devicePixelRatio || 1;
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                context.scale(ratio, ratio);
                context.lineWidth = 2;
            }

            resizeCanvas();

            function preventDefaultTouch(event) {
                event.preventDefault();
            }

            function startDrawing(event) {
                drawing = true;
                const rect = canvas.getBoundingClientRect();
                const x = (event.touches ? event.touches[0].clientX : event.clientX) - rect.left;
                const y = (event.touches ? event.touches[0].clientY : event.clientY) - rect.top;
                context.beginPath();
                context.moveTo(x, y);
            }

            function draw(event) {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (event.touches ? event.touches[0].clientX : event.clientX) - rect.left;
                const y = (event.touches ? event.touches[0].clientY : event.clientY) - rect.top;
                context.lineTo(x, y);
                context.stroke();
            }

            function stopDrawing() {
                drawing = false;
                context.closePath();
            }

            function clearSignature() {
                context.clearRect(0, 0, canvas.width, canvas.height);
            }

            canvas.addEventListener("mousedown", startDrawing);
            canvas.addEventListener("mousemove", draw);
            canvas.addEventListener("mouseup", stopDrawing);
            canvas.addEventListener("mouseout", stopDrawing);

            canvas.addEventListener("touchstart", startDrawing, {
                passive: false
            });
            canvas.addEventListener("touchmove", draw, {
                passive: false
            });
            canvas.addEventListener("touchend", stopDrawing);
            canvas.addEventListener("touchcancel", stopDrawing);

            canvas.addEventListener("touchstart", preventDefaultTouch, {
                passive: false
            });
            canvas.addEventListener("touchmove", preventDefaultTouch, {
                passive: false
            });
        });

        // Define clearSignature function globally
        function clearSignature() {
            const canvas = document.getElementById("signatureCanvas");
            const context = canvas.getContext("2d");
            context.clearRect(0, 0, canvas.width, canvas.height);
        }
    </script>
</body>

</html>